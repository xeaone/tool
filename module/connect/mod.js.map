{
  "version": 3,
  "sources": ["http-fetch:https://deno.land/std@0.219.1/fmt/colors.ts", "http-fetch:https://deno.land/std@0.219.1/encoding/_util.ts", "http-fetch:https://deno.land/std@0.219.1/encoding/base64.ts", "http-fetch:https://deno.land/std@0.219.1/encoding/base64url.ts", "../../jwt/mod.ts", "../../connect/mod.ts"],
  "sourcesContent": ["// Copyright 2018-2024 the Deno authors. All rights reserved. MIT license.\n// This module is browser compatible.\n// A module to print ANSI terminal colors. Inspired by chalk, kleur, and colors\n// on npm.\n\n/**\n * String formatters and utilities for dealing with ANSI color codes.\n *\n * This module is browser compatible.\n *\n * This module supports `NO_COLOR` environmental variable disabling any coloring\n * if `NO_COLOR` is set.\n *\n * @example\n * ```ts\n * import {\n *   bgBlue,\n *   bgRgb24,\n *   bgRgb8,\n *   bold,\n *   italic,\n *   red,\n *   rgb24,\n *   rgb8,\n * } from \"https://deno.land/std@$STD_VERSION/fmt/colors.ts\";\n *\n * console.log(bgBlue(italic(red(bold(\"Hello, World!\")))));\n *\n * // also supports 8bit colors\n *\n * console.log(rgb8(\"Hello, World!\", 42));\n *\n * console.log(bgRgb8(\"Hello, World!\", 42));\n *\n * // and 24bit rgb\n *\n * console.log(rgb24(\"Hello, World!\", {\n *   r: 41,\n *   g: 42,\n *   b: 43,\n * }));\n *\n * console.log(bgRgb24(\"Hello, World!\", {\n *   r: 41,\n *   g: 42,\n *   b: 43,\n * }));\n * ```\n *\n * @module\n */\n\n// deno-lint-ignore no-explicit-any\nconst { Deno } = globalThis as any;\nconst noColor = typeof Deno?.noColor === \"boolean\"\n  ? Deno.noColor as boolean\n  : false;\n\ninterface Code {\n  open: string;\n  close: string;\n  regexp: RegExp;\n}\n\n/** RGB 8-bits per channel. Each in range `0->255` or `0x00->0xff` */\nexport interface Rgb {\n  /** Red component value */\n  r: number;\n  /** Green component value */\n  g: number;\n  /** Blue component value */\n  b: number;\n}\n\nlet enabled = !noColor;\n\n/**\n * Set changing text color to enabled or disabled\n * @param value\n */\nexport function setColorEnabled(value: boolean) {\n  if (Deno?.noColor) {\n    return;\n  }\n\n  enabled = value;\n}\n\n/** Get whether text color change is enabled or disabled. */\nexport function getColorEnabled(): boolean {\n  return enabled;\n}\n\n/**\n * Builds color code\n * @param open\n * @param close\n */\nfunction code(open: number[], close: number): Code {\n  return {\n    open: `\\x1b[${open.join(\";\")}m`,\n    close: `\\x1b[${close}m`,\n    regexp: new RegExp(`\\\\x1b\\\\[${close}m`, \"g\"),\n  };\n}\n\n/**\n * Applies color and background based on color code and its associated text\n * @param str text to apply color settings to\n * @param code color code to apply\n */\nfunction run(str: string, code: Code): string {\n  return enabled\n    ? `${code.open}${str.replace(code.regexp, code.open)}${code.close}`\n    : str;\n}\n\n/**\n * Reset the text modified.\n * @param str text to reset\n */\nexport function reset(str: string): string {\n  return run(str, code([0], 0));\n}\n\n/**\n * Make the text bold.\n * @param str text to make bold\n */\nexport function bold(str: string): string {\n  return run(str, code([1], 22));\n}\n\n/**\n * The text emits only a small amount of light.\n * @param str text to dim\n *\n * Warning: Not all terminal emulators support `dim`.\n * For compatibility across all terminals, use {@linkcode gray} or {@linkcode brightBlack} instead.\n */\nexport function dim(str: string): string {\n  return run(str, code([2], 22));\n}\n\n/**\n * Make the text italic.\n * @param str text to make italic\n */\nexport function italic(str: string): string {\n  return run(str, code([3], 23));\n}\n\n/**\n * Make the text underline.\n * @param str text to underline\n */\nexport function underline(str: string): string {\n  return run(str, code([4], 24));\n}\n\n/**\n * Invert background color and text color.\n * @param str text to invert its color\n */\nexport function inverse(str: string): string {\n  return run(str, code([7], 27));\n}\n\n/**\n * Make the text hidden.\n * @param str text to hide\n */\nexport function hidden(str: string): string {\n  return run(str, code([8], 28));\n}\n\n/**\n * Put horizontal line through the center of the text.\n * @param str text to strike through\n */\nexport function strikethrough(str: string): string {\n  return run(str, code([9], 29));\n}\n\n/**\n * Set text color to black.\n * @param str text to make black\n */\nexport function black(str: string): string {\n  return run(str, code([30], 39));\n}\n\n/**\n * Set text color to red.\n * @param str text to make red\n */\nexport function red(str: string): string {\n  return run(str, code([31], 39));\n}\n\n/**\n * Set text color to green.\n * @param str text to make green\n */\nexport function green(str: string): string {\n  return run(str, code([32], 39));\n}\n\n/**\n * Set text color to yellow.\n * @param str text to make yellow\n */\nexport function yellow(str: string): string {\n  return run(str, code([33], 39));\n}\n\n/**\n * Set text color to blue.\n * @param str text to make blue\n */\nexport function blue(str: string): string {\n  return run(str, code([34], 39));\n}\n\n/**\n * Set text color to magenta.\n * @param str text to make magenta\n */\nexport function magenta(str: string): string {\n  return run(str, code([35], 39));\n}\n\n/**\n * Set text color to cyan.\n * @param str text to make cyan\n */\nexport function cyan(str: string): string {\n  return run(str, code([36], 39));\n}\n\n/**\n * Set text color to white.\n * @param str text to make white\n */\nexport function white(str: string): string {\n  return run(str, code([37], 39));\n}\n\n/**\n * Set text color to gray.\n * @param str text to make gray\n */\nexport function gray(str: string): string {\n  return brightBlack(str);\n}\n\n/**\n * Set text color to bright black.\n * @param str text to make bright-black\n */\nexport function brightBlack(str: string): string {\n  return run(str, code([90], 39));\n}\n\n/**\n * Set text color to bright red.\n * @param str text to make bright-red\n */\nexport function brightRed(str: string): string {\n  return run(str, code([91], 39));\n}\n\n/**\n * Set text color to bright green.\n * @param str text to make bright-green\n */\nexport function brightGreen(str: string): string {\n  return run(str, code([92], 39));\n}\n\n/**\n * Set text color to bright yellow.\n * @param str text to make bright-yellow\n */\nexport function brightYellow(str: string): string {\n  return run(str, code([93], 39));\n}\n\n/**\n * Set text color to bright blue.\n * @param str text to make bright-blue\n */\nexport function brightBlue(str: string): string {\n  return run(str, code([94], 39));\n}\n\n/**\n * Set text color to bright magenta.\n * @param str text to make bright-magenta\n */\nexport function brightMagenta(str: string): string {\n  return run(str, code([95], 39));\n}\n\n/**\n * Set text color to bright cyan.\n * @param str text to make bright-cyan\n */\nexport function brightCyan(str: string): string {\n  return run(str, code([96], 39));\n}\n\n/**\n * Set text color to bright white.\n * @param str text to make bright-white\n */\nexport function brightWhite(str: string): string {\n  return run(str, code([97], 39));\n}\n\n/**\n * Set background color to black.\n * @param str text to make its background black\n */\nexport function bgBlack(str: string): string {\n  return run(str, code([40], 49));\n}\n\n/**\n * Set background color to red.\n * @param str text to make its background red\n */\nexport function bgRed(str: string): string {\n  return run(str, code([41], 49));\n}\n\n/**\n * Set background color to green.\n * @param str text to make its background green\n */\nexport function bgGreen(str: string): string {\n  return run(str, code([42], 49));\n}\n\n/**\n * Set background color to yellow.\n * @param str text to make its background yellow\n */\nexport function bgYellow(str: string): string {\n  return run(str, code([43], 49));\n}\n\n/**\n * Set background color to blue.\n * @param str text to make its background blue\n */\nexport function bgBlue(str: string): string {\n  return run(str, code([44], 49));\n}\n\n/**\n *  Set background color to magenta.\n * @param str text to make its background magenta\n */\nexport function bgMagenta(str: string): string {\n  return run(str, code([45], 49));\n}\n\n/**\n * Set background color to cyan.\n * @param str text to make its background cyan\n */\nexport function bgCyan(str: string): string {\n  return run(str, code([46], 49));\n}\n\n/**\n * Set background color to white.\n * @param str text to make its background white\n */\nexport function bgWhite(str: string): string {\n  return run(str, code([47], 49));\n}\n\n/**\n * Set background color to bright black.\n * @param str text to make its background bright-black\n */\nexport function bgBrightBlack(str: string): string {\n  return run(str, code([100], 49));\n}\n\n/**\n * Set background color to bright red.\n * @param str text to make its background bright-red\n */\nexport function bgBrightRed(str: string): string {\n  return run(str, code([101], 49));\n}\n\n/**\n * Set background color to bright green.\n * @param str text to make its background bright-green\n */\nexport function bgBrightGreen(str: string): string {\n  return run(str, code([102], 49));\n}\n\n/**\n * Set background color to bright yellow.\n * @param str text to make its background bright-yellow\n */\nexport function bgBrightYellow(str: string): string {\n  return run(str, code([103], 49));\n}\n\n/**\n * Set background color to bright blue.\n * @param str text to make its background bright-blue\n */\nexport function bgBrightBlue(str: string): string {\n  return run(str, code([104], 49));\n}\n\n/**\n * Set background color to bright magenta.\n * @param str text to make its background bright-magenta\n */\nexport function bgBrightMagenta(str: string): string {\n  return run(str, code([105], 49));\n}\n\n/**\n * Set background color to bright cyan.\n * @param str text to make its background bright-cyan\n */\nexport function bgBrightCyan(str: string): string {\n  return run(str, code([106], 49));\n}\n\n/**\n * Set background color to bright white.\n * @param str text to make its background bright-white\n */\nexport function bgBrightWhite(str: string): string {\n  return run(str, code([107], 49));\n}\n\n/* Special Color Sequences */\n\n/**\n * Clam and truncate color codes\n * @param n\n * @param max number to truncate to\n * @param min number to truncate from\n */\nfunction clampAndTruncate(n: number, max = 255, min = 0): number {\n  return Math.trunc(Math.max(Math.min(n, max), min));\n}\n\n/**\n * Set text color using paletted 8bit colors.\n * https://en.wikipedia.org/wiki/ANSI_escape_code#8-bit\n * @param str text color to apply paletted 8bit colors to\n * @param color code\n */\nexport function rgb8(str: string, color: number): string {\n  return run(str, code([38, 5, clampAndTruncate(color)], 39));\n}\n\n/**\n * Set background color using paletted 8bit colors.\n * https://en.wikipedia.org/wiki/ANSI_escape_code#8-bit\n * @param str text color to apply paletted 8bit background colors to\n * @param color code\n */\nexport function bgRgb8(str: string, color: number): string {\n  return run(str, code([48, 5, clampAndTruncate(color)], 49));\n}\n\n/**\n * Set text color using 24bit rgb.\n * `color` can be a number in range `0x000000` to `0xffffff` or\n * an `Rgb`.\n *\n * To produce the color magenta:\n *\n * ```ts\n * import { rgb24 } from \"https://deno.land/std@$STD_VERSION/fmt/colors.ts\";\n *\n * rgb24(\"foo\", 0xff00ff);\n * rgb24(\"foo\", {r: 255, g: 0, b: 255});\n * ```\n * @param str text color to apply 24bit rgb to\n * @param color code\n */\nexport function rgb24(str: string, color: number | Rgb): string {\n  if (typeof color === \"number\") {\n    return run(\n      str,\n      code(\n        [38, 2, (color >> 16) & 0xff, (color >> 8) & 0xff, color & 0xff],\n        39,\n      ),\n    );\n  }\n  return run(\n    str,\n    code(\n      [\n        38,\n        2,\n        clampAndTruncate(color.r),\n        clampAndTruncate(color.g),\n        clampAndTruncate(color.b),\n      ],\n      39,\n    ),\n  );\n}\n\n/**\n * Set background color using 24bit rgb.\n * `color` can be a number in range `0x000000` to `0xffffff` or\n * an `Rgb`.\n *\n * To produce the color magenta:\n *\n * ```ts\n * import { bgRgb24 } from \"https://deno.land/std@$STD_VERSION/fmt/colors.ts\";\n *\n * bgRgb24(\"foo\", 0xff00ff);\n * bgRgb24(\"foo\", {r: 255, g: 0, b: 255});\n * ```\n * @param str text color to apply 24bit rgb to\n * @param color code\n */\nexport function bgRgb24(str: string, color: number | Rgb): string {\n  if (typeof color === \"number\") {\n    return run(\n      str,\n      code(\n        [48, 2, (color >> 16) & 0xff, (color >> 8) & 0xff, color & 0xff],\n        49,\n      ),\n    );\n  }\n  return run(\n    str,\n    code(\n      [\n        48,\n        2,\n        clampAndTruncate(color.r),\n        clampAndTruncate(color.g),\n        clampAndTruncate(color.b),\n      ],\n      49,\n    ),\n  );\n}\n\n// https://github.com/chalk/ansi-regex/blob/02fa893d619d3da85411acc8fd4e2eea0e95a9d9/index.js\nconst ANSI_PATTERN = new RegExp(\n  [\n    \"[\\\\u001B\\\\u009B][[\\\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\\\d\\\\/#&.:=?%@~_]+)*|[a-zA-Z\\\\d]+(?:;[-a-zA-Z\\\\d\\\\/#&.:=?%@~_]*)*)?\\\\u0007)\",\n    \"(?:(?:\\\\d{1,4}(?:;\\\\d{0,4})*)?[\\\\dA-PR-TXZcf-nq-uy=><~]))\",\n  ].join(\"|\"),\n  \"g\",\n);\n\n/**\n * Remove ANSI escape codes from the string.\n * @param string to remove ANSI escape codes from\n *\n *  @deprecated (will be removed in 1.0.0) Use {@linkcode stripAnsiCode} instead.\n */\nexport function stripColor(string: string): string {\n  return stripAnsiCode(string);\n}\n\n/**\n * Remove ANSI escape codes from the string.\n *\n * @param string to remove ANSI escape codes from\n */\nexport function stripAnsiCode(string: string): string {\n  return string.replace(ANSI_PATTERN, \"\");\n}\n", "// Copyright 2018-2024 the Deno authors. All rights reserved. MIT license.\n\nconst encoder = new TextEncoder();\n\nfunction getTypeName(value: unknown): string {\n  const type = typeof value;\n  if (type !== \"object\") {\n    return type;\n  } else if (value === null) {\n    return \"null\";\n  } else {\n    return value?.constructor?.name ?? \"object\";\n  }\n}\n\nexport function validateBinaryLike(source: unknown): Uint8Array {\n  if (typeof source === \"string\") {\n    return encoder.encode(source);\n  } else if (source instanceof Uint8Array) {\n    return source;\n  } else if (source instanceof ArrayBuffer) {\n    return new Uint8Array(source);\n  }\n  throw new TypeError(\n    `The input must be a Uint8Array, a string, or an ArrayBuffer. Received a value of the type ${\n      getTypeName(source)\n    }.`,\n  );\n}\n", "// Copyright 2018-2024 the Deno authors. All rights reserved. MIT license.\n// This module is browser compatible.\n\n/**\n * Utilities for\n * {@link https://datatracker.ietf.org/doc/html/rfc4648#section-4 | base64}\n * encoding and decoding.\n *\n * This module is browser compatible.\n *\n * @module\n */\n\nimport { validateBinaryLike } from \"./_util.ts\";\n\nconst base64abc = [\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n  \"G\",\n  \"H\",\n  \"I\",\n  \"J\",\n  \"K\",\n  \"L\",\n  \"M\",\n  \"N\",\n  \"O\",\n  \"P\",\n  \"Q\",\n  \"R\",\n  \"S\",\n  \"T\",\n  \"U\",\n  \"V\",\n  \"W\",\n  \"X\",\n  \"Y\",\n  \"Z\",\n  \"a\",\n  \"b\",\n  \"c\",\n  \"d\",\n  \"e\",\n  \"f\",\n  \"g\",\n  \"h\",\n  \"i\",\n  \"j\",\n  \"k\",\n  \"l\",\n  \"m\",\n  \"n\",\n  \"o\",\n  \"p\",\n  \"q\",\n  \"r\",\n  \"s\",\n  \"t\",\n  \"u\",\n  \"v\",\n  \"w\",\n  \"x\",\n  \"y\",\n  \"z\",\n  \"0\",\n  \"1\",\n  \"2\",\n  \"3\",\n  \"4\",\n  \"5\",\n  \"6\",\n  \"7\",\n  \"8\",\n  \"9\",\n  \"+\",\n  \"/\",\n];\n\n/**\n * Converts data into a base64-encoded string.\n *\n * @see {@link https://datatracker.ietf.org/doc/html/rfc4648#section-4}\n *\n * @example\n * ```ts\n * import { encodeBase64 } from \"https://deno.land/std@$STD_VERSION/encoding/base64.ts\";\n *\n * encodeBase64(\"foobar\"); // \"Zm9vYmFy\"\n * ```\n */\nexport function encodeBase64(data: ArrayBuffer | Uint8Array | string): string {\n  // CREDIT: https://gist.github.com/enepomnyaschih/72c423f727d395eeaa09697058238727\n  const uint8 = validateBinaryLike(data);\n  let result = \"\",\n    i;\n  const l = uint8.length;\n  for (i = 2; i < l; i += 3) {\n    result += base64abc[(uint8[i - 2]!) >> 2];\n    result += base64abc[\n      (((uint8[i - 2]!) & 0x03) << 4) |\n      ((uint8[i - 1]!) >> 4)\n    ];\n    result += base64abc[\n      (((uint8[i - 1]!) & 0x0f) << 2) |\n      ((uint8[i]!) >> 6)\n    ];\n    result += base64abc[(uint8[i]!) & 0x3f];\n  }\n  if (i === l + 1) {\n    // 1 octet yet to write\n    result += base64abc[(uint8[i - 2]!) >> 2];\n    result += base64abc[((uint8[i - 2]!) & 0x03) << 4];\n    result += \"==\";\n  }\n  if (i === l) {\n    // 2 octets yet to write\n    result += base64abc[(uint8[i - 2]!) >> 2];\n    result += base64abc[\n      (((uint8[i - 2]!) & 0x03) << 4) |\n      ((uint8[i - 1]!) >> 4)\n    ];\n    result += base64abc[((uint8[i - 1]!) & 0x0f) << 2];\n    result += \"=\";\n  }\n  return result;\n}\n\n/**\n * Decodes a base64-encoded string.\n *\n * @see {@link https://datatracker.ietf.org/doc/html/rfc4648#section-4}\n *\n * @example\n * ```ts\n * import { encodeBase64 } from \"https://deno.land/std@$STD_VERSION/encoding/base64.ts\";\n *\n * encodeBase64(\"foobar\"); // \"Zm9vYmFy\"\n * ```\n */\nexport function decodeBase64(b64: string): Uint8Array {\n  const binString = atob(b64);\n  const size = binString.length;\n  const bytes = new Uint8Array(size);\n  for (let i = 0; i < size; i++) {\n    bytes[i] = binString.charCodeAt(i);\n  }\n  return bytes;\n}\n", "// Copyright 2018-2024 the Deno authors. All rights reserved. MIT license.\n// This module is browser compatible.\n\n/**\n * Utilities for\n * {@link https://datatracker.ietf.org/doc/html/rfc4648#section-5 | base64url}\n * encoding and decoding.\n *\n * This module is browser compatible.\n *\n * @module\n */\n\nimport * as base64 from \"./base64.ts\";\n\n/**\n * Some variants allow or require omitting the padding '=' signs:\n * https://en.wikipedia.org/wiki/Base64#The_URL_applications\n *\n * @param base64url\n */\nfunction addPaddingToBase64url(base64url: string): string {\n  if (base64url.length % 4 === 2) return base64url + \"==\";\n  if (base64url.length % 4 === 3) return base64url + \"=\";\n  if (base64url.length % 4 === 1) {\n    throw new TypeError(\"Illegal base64url string!\");\n  }\n  return base64url;\n}\n\nfunction convertBase64urlToBase64(b64url: string): string {\n  if (!/^[-_A-Z0-9]*?={0,2}$/i.test(b64url)) {\n    // Contains characters not part of base64url spec.\n    throw new TypeError(\"Failed to decode base64url: invalid character\");\n  }\n  return addPaddingToBase64url(b64url).replace(/\\-/g, \"+\").replace(/_/g, \"/\");\n}\n\nfunction convertBase64ToBase64url(b64: string) {\n  return b64.endsWith(\"=\")\n    ? b64.endsWith(\"==\")\n      ? b64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").slice(0, -2)\n      : b64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").slice(0, -1)\n    : b64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n}\n\n/**\n * Convert data into a base64url-encoded string.\n *\n * @see {@link https://datatracker.ietf.org/doc/html/rfc4648#section-5}\n *\n * @example\n * ```ts\n * import { encodeBase64Url } from \"https://deno.land/std@$STD_VERSION/encoding/base64url.ts\";\n *\n * encodeBase64Url(new TextEncoder().encode(\"foobar\")); // \"Zm9vYmFy\"\n * ```\n */\nexport function encodeBase64Url(\n  data: ArrayBuffer | Uint8Array | string,\n): string {\n  return convertBase64ToBase64url(base64.encodeBase64(data));\n}\n\n/**\n * Decodes a given base64url-encoded string.\n *\n * @see {@link https://datatracker.ietf.org/doc/html/rfc4648#section-5}\n *\n * @example\n * ```ts\n * import { decodeBase64Url } from \"https://deno.land/std@$STD_VERSION/encoding/base64url.ts\";\n *\n * decodeBase64Url(\"Zm9vYmFy\"); // Uint8Array(6) [ 102, 111, 111, 98, 97, 114 ]\n * ```\n */\nexport function decodeBase64Url(b64url: string): Uint8Array {\n  return base64.decodeBase64(convertBase64urlToBase64(b64url));\n}\n", "import { encodeBase64Url } from '../deps.ts';\nimport { decodeBase64 } from '../deps.ts';\n\nexport type Header = {\n    alg: 'RS256';\n    [key: string]: unknown;\n};\n\nexport type Payload = {\n    iss: string;\n    aud: string;\n    exp: number;\n    iat: number;\n    scope: string;\n};\n\nconst encoder = new TextEncoder();\n\nexport default async function jwt(\n    header: Header,\n    payload: Payload,\n    secret: string,\n): Promise<string> {\n    const encodedHeader = encodeBase64Url(JSON.stringify(header));\n    const encodedPayload = encodeBase64Url(JSON.stringify(payload));\n    const data = encoder.encode(`${encodedHeader}.${encodedPayload}`);\n\n    const cleanedKey = secret.replace(\n        /^\\n?-----BEGIN PRIVATE KEY-----\\n?|\\n?-----END PRIVATE KEY-----\\n?$/g,\n        '',\n    );\n    const decodedKey = decodeBase64(cleanedKey).buffer;\n    const key = await crypto.subtle.importKey(\n        'pkcs8',\n        decodedKey,\n        { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-256' },\n        true,\n        ['sign'],\n    );\n\n    const signature = await crypto.subtle.sign(\n        { hash: { name: 'SHA-256' }, name: 'RSASSA-PKCS1-v1_5' },\n        key,\n        data,\n    );\n    const encodedSignature = encodeBase64Url(signature);\n\n    return `${encodedHeader}.${encodedPayload}.${encodedSignature}`;\n}\n", "import jwt from '../jwt/mod.ts';\n\n// https://developers.google.com/identity/protocols/oauth2/service-account\ntype ServiceAccountCredentials = {\n    type: 'service_account';\n    project_id: string;\n    private_key_id: string;\n    private_key: string;\n    client_email: string;\n    client_id: string;\n    auth_uri?: string;\n    token_uri?: string;\n    client_x509_cert_url?: string;\n    auth_provider_x509_cert_url?: string;\n};\n\n// https://developers.google.com/identity/protocols/oauth2/web-server#offline\ntype ApplicationDefaultCredentials = {\n    type: 'authorized_user';\n    client_id: string;\n    client_secret: string;\n    grant_type: string;\n    refresh_token: string;\n};\n\ntype Credential =\n    | 'meta'\n    | 'application'\n    | ApplicationDefaultCredentials\n    | ServiceAccountCredentials;\n\ntype Options = {\n    project?: string;\n    timeout?: number;\n    attempts?: number;\n    // credential?: Credential;\n    serviceAccountCredentials?: ServiceAccountCredentials;\n    applicationDefaultCredentials?: ApplicationDefaultCredentials;\n};\n\nclass Google {\n    #token?: string;\n    #expires?: number;\n    #project?: string;\n    #attempts = 10;\n    #timeout = 1000;\n    #serviceAccountCredentials?: ServiceAccountCredentials;\n    #applicationDefaultCredentials?: ApplicationDefaultCredentials;\n\n    constructor(options?: Options) {\n        this.#project = options?.project;\n        this.#timeout = options?.timeout ?? this.#timeout;\n        this.#attempts = options?.attempts ?? this.#attempts;\n        this.#serviceAccountCredentials = options?.serviceAccountCredentials;\n        this.#applicationDefaultCredentials = options?.applicationDefaultCredentials;\n    }\n\n    async #auth(attempts: number): Promise<void> {\n        if (this.#expires && this.#expires >= Date.now()) return;\n\n        let response;\n        if (this.#applicationDefaultCredentials) {\n            response = await fetch('https://oauth2.googleapis.com/token', {\n                method: 'POST',\n                signal: AbortSignal.timeout(this.#timeout * attempts),\n                body: new URLSearchParams(this.#applicationDefaultCredentials),\n            });\n        } else if (this.#serviceAccountCredentials) {\n            const { client_email, private_key } = this.#serviceAccountCredentials;\n            const iss = client_email;\n            const iat = Math.round(Date.now() / 1000);\n            const exp = iat + (30 * 60);\n            const aud = 'https://oauth2.googleapis.com/token';\n            const scope = 'https://www.googleapis.com/auth/datastore';\n            const assertion = await jwt({ typ: 'JWT', alg: 'RS256' }, { exp, iat, iss, aud, scope }, private_key);\n            const grant_type = 'urn:ietf:params:oauth:grant-type:jwt-bearer';\n            response = await fetch('https://oauth2.googleapis.com/token', {\n                method: 'POST',\n                body: new URLSearchParams({ assertion, grant_type }),\n                signal: AbortSignal.timeout(this.#timeout * attempts),\n            });\n        } else {\n            try {\n                response = await fetch(\n                    'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token',\n                    {\n                        method: 'GET',\n                        headers: { 'Metadata-Flavor': 'Google' },\n                        signal: AbortSignal.timeout(this.#timeout * attempts),\n                    },\n                );\n            } catch (error) {\n                if (error?.name !== 'TimeoutError') {\n                    throw new Error('credentials required');\n                } else {\n                    throw new Error(error.message, { cause: error });\n                }\n            }\n        }\n\n        if (response.status !== 200) {\n            throw new Error(`${response.status} ${response.statusText} ${await response.text()}`);\n        }\n\n        const result = await response.json();\n\n        this.#token = result.access_token;\n        this.#expires = Date.now() + (result.expires_in * 1000);\n    }\n\n    applicationDefault(\n        applicationDefaultCredentials: ApplicationDefaultCredentials,\n    ): this {\n        this.#applicationDefaultCredentials = {\n            ...applicationDefaultCredentials,\n            grant_type: 'refresh_token',\n        };\n        return this;\n    }\n\n    serviceAccount(serviceAccountCredentials: ServiceAccountCredentials): this {\n        this.#serviceAccountCredentials = { ...serviceAccountCredentials };\n        return this;\n    }\n\n    /**\n     * @description\n     *      Initialize application default credentials with `gcloud auth application-default login`.\n     *      This file should be created and will be used as the application credential:\n     *      - Windows: %APPDATA%\\gcloud\\application_default_credentials.json\n     *      - Linux/Mac: $HOME/.config/gcloud/application_default_credentials.json\n     * @param credential\n     */\n    credential(credential: Credential): void {\n        // const command = await new Deno.Command('gcloud', {\n        //     args: ['auth', 'application-default', 'print-access-token'],\n        //     stderr: 'inherit',\n        // }).output();\n        // result = {\n        //     expires_in: 3599,\n        //     access_token: new TextDecoder().decode(command.stdout),\n        // };\n\n        if (credential === 'meta') {\n            return;\n        } else if (credential === 'application') {\n            let file;\n\n            try {\n                const prefix = Deno.build.os === 'windows' ? Deno.env.get('APPDATA') : `${Deno.env.get('HOME')}/.config`;\n                file = Deno.readTextFileSync(\n                    `${prefix}/gcloud/application_default_credentials.json`,\n                );\n            } catch {\n                return;\n            }\n\n            const data = JSON.parse(file);\n            this.#applicationDefaultCredentials = {\n                ...data,\n                grant_type: 'refresh_token',\n            };\n        } else if (credential.type === 'authorized_user') {\n            this.applicationDefault(credential as ApplicationDefaultCredentials);\n        } else if (credential.type === 'service_account') {\n            this.serviceAccount(credential as ServiceAccountCredentials);\n        } else {\n            throw new Error('credential option required');\n        }\n    }\n\n    /**\n     * @description\n     * @param {String} data\n     * @returns {Google}\n     */\n    project(data: string): this {\n        this.#project = data;\n        return this;\n    }\n\n    /**\n     * @description Sets the max request time. Defaults to 1000ms.\n     * @param {Number} timeout The milliseconds for request a timeout.\n     * @return {Google}\n     */\n    timeout(timeout: number): this {\n        this.#timeout = timeout;\n        return this;\n    }\n\n    /**\n     * @description Sets the max retry atttempts after request timeout. Defaults to 5.\n     * @param {Number} attempts The amount of attempts for timeout retries.\n     * @return {Google}\n     */\n    attempts(attempts: number): this {\n        this.#attempts = attempts;\n        return this;\n    }\n\n    async fetch(input: string | URL | Request, init?: RequestInit, attempts?: number): Promise<Response> {\n        attempts = attempts || 1;\n        try {\n            if (!this.project) {\n                const projectResponse = await fetch(\n                    'http://metadata.google.internal/computeMetadata/v1/project/project-id',\n                    {\n                        method: 'GET',\n                        headers: { 'Metadata-Flavor': 'Google' },\n                        signal: AbortSignal.timeout(this.#timeout * attempts),\n                    },\n                );\n\n                this.#project = await projectResponse.text();\n            }\n\n            if (!this.#project) throw new Error('project required');\n\n            await this.#auth(attempts);\n\n            init = init ?? {};\n            init.signal = AbortSignal.timeout(this.#timeout * attempts);\n\n            const request = new Request(input, init);\n\n            if (this.#token) request.headers.set('Authorization', `Bearer ${this.#token}`);\n\n            const response = await fetch(request);\n\n            return response;\n        } catch (error) {\n            if (error?.name === 'TimeoutError' && attempts < this.#attempts) {\n                return this.fetch(input, init, attempts + 1);\n            } else if (error?.name === 'TimeoutError') {\n                return new Response(undefined, { status: 408, headers: { connection: 'close' } });\n            } else {\n                throw new Error(error.message, { cause: error });\n            }\n        }\n    }\n}\n\nexport default {\n    Google,\n};\n"],
  "mappings": "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",
  "names": ["Deno", "encoder"]
}
