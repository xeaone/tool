{
  "version": 3,
  "sources": ["../../access/mod.ts"],
  "sourcesContent": ["// type Action = 'view' | 'search' | 'create' | 'update' | 'remove';\n\ntype Permission = {\n    // view: boolean;\n    // search: boolean;\n    // create: boolean;\n    // update: boolean;\n    // remove: boolean;\n    resource: string;\n    [key: string]: string | boolean;\n};\n\ntype Options = {\n    actions: Array<string>;\n    resources: Array<string>;\n};\n\nclass Access {\n    #actions: Array<string> = [];\n    #resources: Array<string> = [];\n\n    constructor(options?: Options) {\n        this.#actions = options?.actions ?? this.#actions;\n        this.#resources = options?.resources ?? this.#resources;\n    }\n\n    actions(actions: Array<string>): this {\n        this.#actions = actions;\n        return this;\n    }\n\n    resources(resources: Array<string>): this {\n        this.#resources = resources;\n        return this;\n    }\n\n    // checks if access is allowed\n    allowed<P extends Permission>(\n        permissions: Array<P>,\n        resource: string,\n        action: string,\n    ): boolean {\n        if (!this.#actions.includes(action)) return false;\n        if (!this.#resources.includes(resource)) return false;\n        if (permissions instanceof Array === false) return false;\n\n        for (const permission of permissions) {\n            if (\n                permission.resource === resource && permission[action] === true\n            ) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    // checks permission format\n    formated<P extends Permission>(permissions: Array<P>): boolean {\n        if (permissions instanceof Array === false) return false;\n\n        for (const permission of permissions) {\n            if (this.#resources.includes(permission.resource) === false) {\n                return false;\n            }\n            if (this.#actions.length !== Object.keys(permission).length) {\n                return false;\n            }\n\n            for (const action of this.#actions) {\n                if (\n                    action in permission === false ||\n                    typeof permission[action] !== 'boolean'\n                ) {\n                    return false;\n                }\n            }\n        }\n\n        return true;\n    }\n\n    // checks a permission against another permission\n    compare<P extends Permission>(\n        credentialPermissions: Array<P>,\n        payloadPermissions: Array<P>,\n    ): boolean {\n        if (payloadPermissions instanceof Array === false) {\n            return false;\n        }\n\n        if (credentialPermissions instanceof Array === false) {\n            return false;\n        }\n\n        for (const payloadPermission of payloadPermissions) {\n            for (const credentialPermission of credentialPermissions) {\n                if (\n                    credentialPermission.resource === payloadPermission.resource\n                ) {\n                    for (const action of this.#actions) {\n                        if (\n                            credentialPermission[action] === false &&\n                            payloadPermission[action] === true\n                        ) {\n                            return false;\n                        }\n                    }\n                }\n            }\n        }\n\n        return true;\n    }\n}\n\nexport default Access;\n"],
  "mappings": ";;;;;;;;;;AAiBA,IAAM,SAAN,MAAa;AAAA,EACT,WAA0B,CAAC;AAAA,EAC3B,aAA4B,CAAC;AAAA,EAE7B,YAAY,SAAmB;AAC3B,SAAK,WAAW,SAAS,WAAW,KAAK;AACzC,SAAK,aAAa,SAAS,aAAa,KAAK;AAAA,EACjD;AAAA,EAEA,QAAQ,SAA8B;AAClC,SAAK,WAAW;AAChB,WAAO;AAAA,EACX;AAAA,EAEA,UAAU,WAAgC;AACtC,SAAK,aAAa;AAClB,WAAO;AAAA,EACX;AAAA;AAAA,EAGA,QACI,aACA,UACA,QACO;AACP,QAAI,CAAC,KAAK,SAAS,SAAS,MAAM;AAAG,aAAO;AAC5C,QAAI,CAAC,KAAK,WAAW,SAAS,QAAQ;AAAG,aAAO;AAChD,QAAI,uBAAuB,UAAU;AAAO,aAAO;AAEnD,eAAW,cAAc,aAAa;AAClC,UACI,WAAW,aAAa,YAAY,WAAW,MAAM,MAAM,MAC7D;AACE,eAAO;AAAA,MACX;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AAAA;AAAA,EAGA,SAA+B,aAAgC;AAC3D,QAAI,uBAAuB,UAAU;AAAO,aAAO;AAEnD,eAAW,cAAc,aAAa;AAClC,UAAI,KAAK,WAAW,SAAS,WAAW,QAAQ,MAAM,OAAO;AACzD,eAAO;AAAA,MACX;AACA,UAAI,KAAK,SAAS,WAAW,OAAO,KAAK,UAAU,EAAE,QAAQ;AACzD,eAAO;AAAA,MACX;AAEA,iBAAW,UAAU,KAAK,UAAU;AAChC,YACI,UAAU,eAAe,SACzB,OAAO,WAAW,MAAM,MAAM,WAChC;AACE,iBAAO;AAAA,QACX;AAAA,MACJ;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AAAA;AAAA,EAGA,QACI,uBACA,oBACO;AACP,QAAI,8BAA8B,UAAU,OAAO;AAC/C,aAAO;AAAA,IACX;AAEA,QAAI,iCAAiC,UAAU,OAAO;AAClD,aAAO;AAAA,IACX;AAEA,eAAW,qBAAqB,oBAAoB;AAChD,iBAAW,wBAAwB,uBAAuB;AACtD,YACI,qBAAqB,aAAa,kBAAkB,UACtD;AACE,qBAAW,UAAU,KAAK,UAAU;AAChC,gBACI,qBAAqB,MAAM,MAAM,SACjC,kBAAkB,MAAM,MAAM,MAChC;AACE,qBAAO;AAAA,YACX;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AACJ;AAEA,IAAO,cAAQ;",
  "names": []
}
